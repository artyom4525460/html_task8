(()=>{"use strict";const e={videoPoster:document.getElementById("videoPoster"),videoButtonBlock:document.getElementById("videoButtonBlock"),videoPlayButton:document.getElementById("videoPlayButton"),videoProgress:document.getElementById("videoProgress"),videoProgressBar:document.getElementById("videoProgressBar"),videoProgressButton:document.getElementById("videoProgressButton"),videoVol:document.getElementById("videoVol"),videoControls:document.getElementById("videoControls"),videoTag:document.getElementById("videoTag"),isMoveProgressButton:!1,videoInit:()=>{void 0!==document.createElement("progress").max||progress.setAttribute("data-state","fake"),videoControls.setAttribute("data-state","visible"),e.videoProgress.max=e.videoTag.duration},hidePlayButton:()=>{e.videoButtonBlock.classList.add("hide")},onPlay:async()=>{e.videoButtonBlock.classList.add("hide"),await e.videoTag.play(),e.videoPlayButton.setAttribute("data-state","play")},onPause:async()=>{"play"==e.videoPlayButton.dataset.state&&(await e.videoTag.pause(),e.videoPlayButton.setAttribute("data-state","pause"))},onPausePlay:()=>{switch(e.videoPlayButton.dataset.state){case"play":e.videoTag.pause(),e.videoPlayButton.setAttribute("data-state","pause");break;case"pause":e.videoTag.play(),e.videoPlayButton.setAttribute("data-state","play")}},progressVideo:()=>{e.videoProgress.value=e.videoTag.currentTime,e.videoProgressButton.style.left=Math.floor(e.videoTag.currentTime/e.videoTag.duration*100)+"%"},moveProgressButton:t=>{t.preventDefault(),e.isMoveProgressButton=!0;let o=t.clientX,d=e.videoProgressButton.offsetLeft;document.addEventListener("mousemove",(function(t){e.isMoveProgressButton&&e.moveToPosition(o,t.clientX,d)})),document.addEventListener("mouseup",(function(t){e.isMoveProgressButton=!1}))},moveToPosition:(t,o,d)=>{let n=o-t;d+n<0?e.videoProgressButton.style.left=0:d+n>e.videoProgress.offsetWidth?e.videoProgressButton.style.left=e.videoProgress.offsetWidth+"px":e.videoProgressButton.style.left=Math.floor(100*(d+n)/e.videoProgress.offsetWidth)+"%",e.videoTag.currentTime=Math.floor(100*(d+n)/e.videoProgress.offsetWidth*e.videoTag.duration/100)},changeSoundVol:()=>{1==e.videoTag.volume?e.videoTag.volume=.1:e.videoTag.volume=(e.videoTag.volume+.1).toFixed(1)}},t={attacheInputLink:document.getElementById("attacheInputLink"),attacheInput:document.getElementById("attacheInput"),chatScreen:document.getElementById("chatScreen"),sendButton:document.getElementById("sendButton"),messageInput:document.getElementById("messageInput"),handleFiles:()=>{let e=t.attacheInput.files;if(FileReader||alert("Your browser doesn't suppport FileReader"),FileReader&&e&&e.length){let o=e[0].type.split("/")[0];t.addSource(o,e[0])}},videoFileHtml:(e,o)=>`\n            <div class="item chat-item video-item" data-value="" id="item-${o}">\n            <div class="close-button" id="close-${o}"><img src='./images/close.svg'/></div>\n                <div class="item-block video-block-container">\n                    <div class="video-block center-flex">\n                        <div class="video">\n                            <video preload="metadata" id="${o}">\n                                <source src="${e}" type="video/mp4">\n                            </video>\n                            <div class="button-block" id="button-block-${o}">\n                                <div class="button" id="button-${o}">\n                                    <img src="./images/play-blue.svg" alt="">\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                    <div class="time">${t.getTime()}</div>\n                </div>\n            </div>\n        `,audioFileHtml:(e,o)=>`\n            <div class="item" id="item-${o}">\n            <div class="close-button" id="close-${o}"><img src='./images/close.svg'/></div>\n                <div class="item-block scale-block-container">\n                    <div class="audio-block">\n                        <audio controls id="${o}">\n                            <source src="${e}">\n                        </audio>\n                    </div>\n                    <div class="time">${t.getTime()}</div>\n                </div>\n            </div>\n        `,imageFileHtml:(e,o)=>`\n        <div class="item" id="item-${o}">\n        <div class="close-button" id="close-${o}"><img src='./images/close.svg'/></div>\n            <div class="item-block images-block-container">\n                <div class="image-block">\n                    <img id="${o}" src="${e}" alt="">\n                </div>\n                <div class="time">${t.getTime()}</div>\n            </div>\n        </div>\n        `,textHtml:(e,t)=>`\n            <div class="item" id="item-${t}">\n                <div class="close-button" id="close-${t}"><img src='./images/close.svg'/></div>\n                    <div class="item-block text-block-container">\n                        <div class="text-block">\n                            ${e}\n                        </div>\n                        <div class="time">2:25 PM</div>\n                    </div>\n                </div>\n            </div>\n        `,addSource:(e,o)=>{switch(e){case"video":t.addVideo(o);break;case"audio":t.addAudio(o);break;case"image":t.addImage(o);break;default:alert("Please attache video, audio or image")}},getTime:()=>{let e=new Date,t=e.getHours(),o="AM",d=e.getMinutes();return t>12&&(t-=12,o="PM"),d<10&&(d="0"+d),`${t}:${d} ${o}`},addImage:e=>{let o=new FileReader;o.readAsDataURL(e),o.onload=function(){let e="image-"+Math.floor(1e3*Math.random());new Promise(((d,n)=>{t.chatScreen.innerHTML+=t.imageFileHtml(o.result,e),d("ok")})).then((()=>{d()}))}},addAudio:e=>{let o=new FileReader;o.readAsDataURL(e),o.onload=function(){let e="audio-"+Math.floor(1e3*Math.random());document.getElementById("item-"+e),new Promise(((d,n)=>{t.chatScreen.innerHTML+=t.audioFileHtml(o.result,e),d("ok")})).then((()=>{document.getElementById("close-"+e),document.getElementById("item-"+e),d()}))}},addVideo:e=>{let o=new FileReader;o.readAsDataURL(e),o.onload=function(){let e="video-"+Math.floor(1e3*Math.random());new Promise(((d,n)=>{t.chatScreen.innerHTML+=t.videoFileHtml(o.result,e),d("ok")})).then((()=>{let t="button-"+e,o=document.getElementById(t),n=document.getElementById(e),a=document.getElementById("button-block-"+e);document.getElementById("item-"+e),document.getElementById("close-"+e),o.addEventListener("click",(function(){a.style.display="none",n.play(),n.setAttribute("data-state","play")})),n.addEventListener("click",(function(){switch(a.style.display="none",n.dataset.state){case"play":n.pause(),n.setAttribute("data-state","pause");break;case"pause":n.play(),n.setAttribute("data-state","play")}})),d()}))}},addText:e=>{let o="message-"+Math.floor(1e3*Math.random());new Promise(((d,n)=>{t.chatScreen.innerHTML+=t.textHtml(e,o),d("ok")})).then((()=>{d()}))}};var o;function d(){o=document.getElementsByClassName("close-button");for(let e=0;e<o.length;e++)o[e].addEventListener("click",(function(){this.parentElement.remove()}))}let n={broadcastButton:document.getElementById("broadcastButton"),clickBroadcastButton:e=>{a.onShow(e),i.onShow(e)}},a={modalBlock:document.getElementById("modalBlock"),onShow:e=>{a.modalBlock.classList.remove("hide")},onHide:()=>{a.modalBlock.classList.add("hide")}},i={videoModalBlock:document.getElementById("videoModalBlock"),videoModalNextButton:document.getElementById("videoModalNextButton"),onShow:t=>{i.videoModalBlock.classList.remove("hide"),e.videoInit()},onNext:()=>{i.videoModalBlock.classList.add("hide"),s.onShow(),e.onPause()}},s={chatModalBlock:document.getElementById("chatModalBlock"),chatBroadcastButton:document.getElementById("chatBroadcastButton"),onShow:e=>{s.chatModalBlock.classList.remove("hide")},onBroadcastClick:()=>{s.chatModalBlock.classList.add("hide"),l.onShow()}},l={uploadingModalBlock:document.getElementById("uploadingModalBlock"),progressScale:document.getElementById("progressScale"),progressPercent:document.getElementById("progressPercent"),onShow:()=>{l.uploadingModalBlock.classList.remove("hide"),l.onLoad()},onHide:()=>{l.uploadingModalBlock.classList.add("hide"),c.onShow()},onLoad:()=>{let e=0,t=setInterval((function(){if(e>100)return clearInterval(t),void l.onHide();progressScale.style.width=e+"%",progressPercent.innerHTML=e+"%",e++}),20)}},c={successModalBlock:document.getElementById("successModalBlock"),successOk:document.getElementById("successOk"),onShow:e=>{c.successModalBlock.classList.remove("hide")},onHide:e=>{c.successModalBlock.classList.add("hide"),a.onHide()}};n.broadcastButton.addEventListener("click",n.clickBroadcastButton),i.videoModalNextButton.addEventListener("click",i.onNext),s.chatBroadcastButton.addEventListener("click",s.onBroadcastClick),c.successOk.addEventListener("click",c.onHide),e.videoPlayButton.addEventListener("click",e.onPlay),e.videoTag.addEventListener("click",e.onPausePlay),e.videoTag.addEventListener("timeupdate",e.progressVideo),e.videoProgressButton.addEventListener("mousedown",e.moveProgressButton),e.videoVol.addEventListener("click",e.changeSoundVol),t.attacheInputLink.addEventListener("click",(function(e){e.preventDefault(),t.attacheInput.click()})),t.attacheInput.addEventListener("change",t.handleFiles,!1),t.sendButton.addEventListener("click",(function(){t.messageInput.value&&(t.addText(t.messageInput.value),t.messageInput.value=null)}))})();